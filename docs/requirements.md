# 智能API规划与调用系统 - 需求文档

## 1. 项目概述

本系统旨在解决开发与运维人员在面对复杂且数量庞大的API生态时，所遇到的API发现困难、调用流程不清晰、手动编写调用代码繁琐且易错的核心痛点。它作为一个智能的“API中间层”，通过自然语言处理和人工智能技术，将人的意图高效、准确地转化为机器可执行的指令，从而提升研发效率和自动化水平。

## 2. 目标用户

- **应用开发者**: 需要在自己的业务逻辑中，调用公司内部其他服务的API。
- **自动化测试工程师**: 需要编写测试脚本，来验证各个API的功能和稳定性。
- **运维与SRE工程师**: 需要在自动化运维脚本（如CI/CD, 监控告警处理）中，编排和调用API来完成特定任务。

## 3. 功能性需求

### 3.1. 核心能力一：多步任务智能规划 (`/plan`)

- **FR-1.1**: 系统必须能够接收用户输入的、可能包含多个步骤的复杂自然语言需求。
- **FR-1.2**: 系统必须能够基于对API输入输出参数的理解，自动分析API之间的数据流依赖关系。
- **FR-1.3**: 系统必须能够根据依赖关系，生成一个定义了清晰执行顺序（支持串行和并行）的结构化任务计划。
- **FR-1.4 (查询增强)**: 在生成计划时，系统应将用户原始请求中的关键信息（如实体、参数值），自动填充到计划的每个步骤描述中，使其成为一个可独立执行的、语义更丰富的指令。
- **FR-1.5 (前置规则)**: 系统应支持预定义的核心业务规则（例如：在调用请假、加班API前，必须先调用获取员工信息的API），并在规划时强制遵循这些规则。

### 3.2. 核心能力二：单次API调用详情生成 (`/generate-api-call`)

- **FR-2.1**: 系统必须能够接收用户输入的、针对单个API的直接自然语言需求。
- **FR-2.2**: 系统必须采用“检索-精排”的两阶段流程，从API知识库中精准地找出与用户需求最匹配的API。
- **FR-2.3**: 系统必须能够利用大语言模型，从用户的自然语言需求中，自动提取并填充API所需的参数。
- **FR-2.4 (缺失提示)**: 当一个或多个必需参数无法从当前用户输入中获取时，系统必须在返回的API调用详情中，清晰地标记出所有缺失的参数及其定义。

### 3.3. 核心能力三：可执行代码生成 (`/generate-groovy-script`)

- **FR-3.1**: 系统必须能够接收用户的API调用意图和一组已知的参数数据。
- **FR-3.2**: 系统必须能够基于API的定义和已知数据，动态生成一段可以直接在自动化工具（如Jenkins, SoapUI）中执行的Groovy脚本。
- **FR-3.3**: 生成的Groovy脚本必须包含完整的HTTP请求逻辑，包括方法、URL、请求头和已填充的请求体。
- **FR-3.4 (缺失提示)**: 如果已知数据中缺少API的必填参数，生成的Groovy脚本必须在代码的注释中，清晰地列出所有缺失的参数名。

## 4. 非功能性需求

- **NF-1 (安全性)**: API密钥等敏感配置信息，严禁硬编码在代码中。必须通过外部环境变量（`.env`文件）进行加载，且`.env`文件本身必须被版本控制系统忽略。
- **NF-2 (可配置性)**: 核心参数，如大语言模型的提供商、模型名称、日志级别等，都必须是可配置的。
- **NF-3 (可维护性)**: 代码必须遵循清晰的、面向对象的结构，每个类和模块都应有明确的单一职责。
- **NF-4 (可靠性)**: 系统必须集成专业的日志系统，能够记录不同级别的日志信息到文件中，以便于问题的排查和审计。
- **NF-5 (可测试性)**: 项目必须包含一套单元测试套件，能够独立于外部服务（如LLM API），对核心业务逻辑进行验证。
